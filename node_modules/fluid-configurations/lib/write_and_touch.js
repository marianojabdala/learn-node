/**
 * Writes a file creating the directories up to it's path and touches the file
 * with a creating and modification time based on the source index
 */
var mkdirp = require("mkdirp"),
  path = require("path"),
  fs = require("fs");

module.exports = function writeAndTouch(filename, data, mtime, callback) {
  var dirname = path.dirname(filename);
  mkdirp(dirname, function () {
    fs.writeFile(filename, data, function (err) {
      if (err) {
        return callback(err);
      }
      fs.utimes(filename, mtime, mtime, callback);
    });
  });
};
