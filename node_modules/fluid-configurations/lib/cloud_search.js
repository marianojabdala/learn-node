#!/usr/bin/env node

var AWS = require("aws-sdk"),
  cloudSearch,
  getCatalogFields,
  cloudSearchConfigs = require(__dirname + "/../config/cloud_search.json"),
  environmentsMap = {
    prod: "production"
  };

cloudSearch = new AWS.CloudSearch({
  // apiVersion: "2011-02-01",
  region: "us-east-1"
});

getCatalogFields = function (options, callback) {

  var params = {
    DomainName: options.DomainName || ((environmentsMap[options.environment] || options.environment) + "-c" + options.customerId),
    Deployed: true
  };

  // The cloudSearch.describeIndexFields method does not work
  // with search domains created on the 2011-02-01 API,
  // for those we have an explicit list of indexes defined under
  // config/cloud_search.json
  // To update the config/cloud_search.json file, you should run
  // ./bin/update_cloud_search_fields

  callback(null, cloudSearchConfigs[params.DomainName].fields || []);

  /*
  cloudSearch.describeIndexFields(params, function (err, data) {
    if (err) {
      return callback(err);
    }
    // TODO: Update return the fields and cache under cloudSearchConfigs
    //       we can't see the response now as we don't have search domains
    //       working with the new API version
    // cloudSearchConfigs[params.DomainName].fields = data.IndexFields; // Options.IndexFieldName
    callback(null, data);
  });
  */
};


module.exports = {
  getCatalogFields: getCatalogFields
};
