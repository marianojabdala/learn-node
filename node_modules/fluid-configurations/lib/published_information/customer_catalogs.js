/**
 * Gets all the catalog for a customer environment and the
 * workflows the catalogs are included on.
 *
 * Example:
 *
 *    getCustomerCatalogs({environment: "prod", "customerId": 1475}, function (err, workflows) {
 *      if (err) { return console.error(err); }
 *      console.log(workflows);
 *    });
 *
 * which produces:
 *
 *    {
 *      "7": {
 *        "environment": "prod",
 *        "customerId": 1475,
 *        "catalogId": 7,
 *        "workflows": [
 *          "af",
 *          "dev-impl",
 *          "prod",
 *          "qa",
 *          "socket-test"
 *        ]
 *      }
 *    }
 */

var getCustomerCatalogs,
  getPublishedEntities = require("../s3").getPublishedEntities,
  _ = require("lodash"),
  memoize = require("../memoizer"),
  default_options = {
    entryPrimaryKey: "catalogId"
  };


getCustomerCatalogs = function getCustomerCatalogs(options, callback) {

  getPublishedEntities(
    _.defaults({}, options, default_options),
    {
      Prefix: options.environment +
        "/{WORKFLOW}/customers/c" +
        options.customerId +
        "/configureHtml/galleries/g_"
    },
    callback
  );
};

module.exports = memoize(getCustomerCatalogs, [
  "workflows", "workflow", "catalogs", "environment",
  "customer", "customers", "customerId"
]);
